{"remainingRequest":"C:\\workspace\\lottery\\lottery-agent-app\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\workspace\\lottery\\lottery-agent-app\\src\\components\\CustomersAdmin.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\workspace\\lottery\\lottery-agent-app\\src\\components\\CustomersAdmin.vue","mtime":1605619368927},{"path":"C:\\workspace\\lottery\\lottery-agent-app\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\workspace\\lottery\\lottery-agent-app\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\workspace\\lottery\\lottery-agent-app\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\workspace\\lottery\\lottery-agent-app\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcycKZXhwb3J0IGRlZmF1bHQgewogICAgZGF0YSAoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgYW1vdW50OiAwLAogICAgICAgICAgICBhZ2VudDoge30sCiAgICAgICAgICAgIGRpYWxvZ1Zpc2libGU6IGZhbHNlLAogICAgICAgICAgICBjdXN0b21lcjoge30sCiAgICAgICAgICAgIGN1c3RvbWVyczogW10sCiAgICAgICAgICAgIHN0YXJ0RGVwb3NpdDogZmFsc2UsCiAgICAgICAgfTsKICAgIH0sCiAgICBtZXRob2RzOiB7CiAgICAgICAgaGFuZGxlQ2xvc2UoKXsKICAgICAgICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZTsKICAgICAgICAgICAgdGhpcy5jdXN0b21lciA9IHt9OwogICAgICAgICAgICB0aGlzLmFtb3VudCA9IDE7CiAgICAgICAgfSwKICAgICAgICBvcGVuRGVwb3NpdERpYWcocm93KSB7CiAgICAgICAgICAgIHRoaXMuYW1vdW50ID0gMTsKICAgICAgICAgICAgdGhpcy5jdXN0b21lciA9IHJvdzsKICAgICAgICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZTsKICAgICAgICB9LAogICAgICAgIHN1Ym1pdERlcG9zaXQoKSB7CiAgICAgICAgICAgIHRoaXMuc3RhcnREZXBvc2l0ID0gdHJ1ZTsKICAgICAgICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgICAgICAgICAiY3VzdG9tZXIiOiB7ImlkIjogdGhpcy5jdXN0b21lci5pZH0sCiAgICAgICAgICAgICAgICAiYWdlbnQiOiB7ImlkIjogdGhpcy5hZ2VudC5pZH0sCiAgICAgICAgICAgICAgICAiYW1vdW50IjogdGhpcy5hbW91bnQKICAgICAgICAgICAgfTsKICAgICAgICAgICAgYXhpb3MKICAgICAgICAgICAgICAgIC5wb3N0KCdodHRwOi8vbG9jYWxob3N0OjgwODAvYXBpL3YxL2FnZW50cy8nK3RoaXMuYWdlbnQuaWQrJ2N1c3RvbWVycy8nICt0aGlzLmFnZW50LmlkKyAnL2RlcG9zaXRzJywgZGF0YSwge2hlYWRlcnM6IHsnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nfX0pCiAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGRlcG9zaXQgPSByZXNwb25zZS5kYXRhOwogICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGN1cyBvZiB0aGlzLmN1c3RvbWVycykgewogICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VzLmlkID09IHRoaXMuY3VzdG9tZXIuaWQpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VzLmRlcG9zaXQgPSAgY3VzLmRlcG9zaXQgKyBkZXBvc2l0LmFtb3VudDsKICAgICAgICAgICAgICAgICAgICAgICAgfSAKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnREZXBvc2l0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsgCiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RhcnREZXBvc2l0ID0gZmFsc2U7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gZmFsc2U7CiAgICAgICAgfQogICAgfSwKICAgIG1vdW50ZWQgKCkgewogICAgICAgIGxldCBhZ2VudElkID0gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShnbG9iYWwuQUdFTlRfSURfS0VZKTsKICAgICAgICBheGlvcwogICAgICAgICAgICAuZ2V0KCdodHRwOi8vbG9jYWxob3N0OjgwODAvYXBpL3YxL2FnZW50cy8nICsgYWdlbnRJZCkKICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gKHRoaXMuYWdlbnQgPSByZXNwb25zZS5kYXRhKSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgeyAKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgYXhpb3MKICAgICAgICAgICAgLmdldCgnaHR0cDovL2xvY2FsaG9zdDo4MDgwL2FwaS92MS9hZ2VudHMvJysgYWdlbnRJZCArICcvY3VzdG9tZXJzP3BhZ2U9MSZzaXplPTEwJykKICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgICAgICAgICAgIHRoaXMuY3VzdG9tZXJzID0gcmVzcG9uc2UuZGF0YS5jb250ZW50OwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgeyAKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICAgICAgfSk7CiAgICB9Cn0K"},{"version":3,"sources":["CustomersAdmin.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CustomersAdmin.vue","sourceRoot":"src/components","sourcesContent":["<template>\n    <div>\n        <div>\n            <div></div>\n        </div>\n        <div>\n            <div>客户列表：</div> \n            <div>\n                <el-table :data=\"customers\" style=\"width: 100%\">\n                    <el-table-column prop=\"tel\" label=\"客户电话\">\n                    </el-table-column>   \n                    <el-table-column prop=\"deposit\" label=\"余额\">\n                    </el-table-column>   \n                    <el-table-column label=\"操作\">\n                        <template slot-scope=\"scope\">\n                            <el-button\n                            size=\"mini\"\n                            @click=\"openDepositDiag(scope.row)\">充值</el-button>\n                        </template>\n                    </el-table-column>\n                </el-table>\n            </div>\n        </div>\n        <el-dialog\n            title=\"充值\"\n            :visible.sync=\"dialogVisible\"\n            width=\"350px\"\n            :before-close=\"handleClose\">\n            <div>\n                <el-form>\n                 <el-form-item label=\"客户电话：\" label-width=\"100px\">\n                    <el-input v-model=\"customer.tel\" size=\"small\" :disabled=\"true\"></el-input>\n                 </el-form-item>\n                </el-form>\n            </div>\n            <div>\n                <el-form>\n                 <el-form-item label=\"客户现值：\" label-width=\"100px\">\n                    <el-input v-model=\"customer.deposit\" size=\"small\" :disabled=\"true\"></el-input>\n                 </el-form-item>\n                </el-form>\n            </div>\n            <div>\n                <el-form>\n                 <el-form-item label=\"客户充值：\" label-width=\"100px\">\n                    <el-input-number v-model=\"amount\" size=\"small\" :precision=\"2\" :step=\"1\" :max=\"1000\"></el-input-number>\n                 </el-form-item>\n                </el-form>\n            </div>\n            <span slot=\"footer\" class=\"dialog-footer\">\n                <el-button @click=\"dialogVisible = false\">取 消</el-button>\n                <el-button type=\"primary\" @click=\"submitDeposit()\" :disabled=\"startDeposit\">确 定</el-button>\n            </span>\n        </el-dialog>\n    </div>\n</template>\n\n<script>\nimport axios from 'axios'\nexport default {\n    data () {\n        return {\n            amount: 0,\n            agent: {},\n            dialogVisible: false,\n            customer: {},\n            customers: [],\n            startDeposit: false,\n        };\n    },\n    methods: {\n        handleClose(){\n            this.dialogVisible = true;\n            this.customer = {};\n            this.amount = 1;\n        },\n        openDepositDiag(row) {\n            this.amount = 1;\n            this.customer = row;\n            this.dialogVisible = true;\n        },\n        submitDeposit() {\n            this.startDeposit = true;\n            let data = {\n                \"customer\": {\"id\": this.customer.id},\n                \"agent\": {\"id\": this.agent.id},\n                \"amount\": this.amount\n            };\n            axios\n                .post('http://localhost:8080/api/v1/agents/'+this.agent.id+'customers/' +this.agent.id+ '/deposits', data, {headers: {'Content-Type': 'application/json'}})\n                .then(response => {\n                    let deposit = response.data;\n                    for (let cus of this.customers) {\n                        if (cus.id == this.customer.id) {\n                           cus.deposit =  cus.deposit + deposit.amount;\n                        } \n                    }\n\n                    this.startDeposit = false;\n                })\n                .catch(error => { \n                    console.log(error);\n                    this.startDeposit = false;\n                });\n            this.dialogVisible = false;\n        }\n    },\n    mounted () {\n        let agentId = sessionStorage.getItem(global.AGENT_ID_KEY);\n        axios\n            .get('http://localhost:8080/api/v1/agents/' + agentId)\n            .then(response => (this.agent = response.data))\n            .catch(function (error) { \n                console.log(error);\n            });\n        axios\n            .get('http://localhost:8080/api/v1/agents/'+ agentId + '/customers?page=1&size=10')\n            .then(response => {\n                    this.customers = response.data.content;\n                })\n            .catch(function (error) { \n                console.log(error);\n            });\n    }\n}\n</script>\n\n<style>\n\n</style>"]}]}