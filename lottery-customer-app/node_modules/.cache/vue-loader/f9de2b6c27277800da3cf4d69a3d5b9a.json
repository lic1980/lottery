{"remainingRequest":"C:\\workspace\\lottery-app\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\workspace\\lottery-app\\src\\components\\Lottery.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\workspace\\lottery-app\\src\\components\\Lottery.vue","mtime":1599142977865},{"path":"C:\\workspace\\lottery-app\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\workspace\\lottery-app\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\workspace\\lottery-app\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\workspace\\lottery-app\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcycKCmV4cG9ydCBkZWZhdWx0IHsKICAgIGRhdGEgKCkgewogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIGZlZTogMCwKICAgICAgICAgICAgY3VycmVudDogbnVsbCwKICAgICAgICAgICAgdGltZXM6IDEsCiAgICAgICAgICAgIGN1c3RvbWVyOiB7ICJpZCI6ICIiLCAiZGVwb3NpdCI6IDAgfSwKICAgICAgICAgICAgbG90dGVyeVJvdW5kOiB7ImxvdHRlcnkiOiB7Im5hbWUiOiIifX0sCiAgICAgICAgICAgIG9wdGlvbnNCeUl0ZW1JZHM6IG5ldyBNYXAoKSwKICAgICAgICAgICAgaXRlbUJ5SXRlbUlkczogbmV3IE1hcCgpLAogICAgICAgICAgICBvcHRpb25zU2VsZWN0ZWQ6IFtdCiAgICAgICAgfQogICAgfSwKICAgIG1ldGhvZHM6IHsKICAgICAgICBzZWxlY3RPcHRpb246IGZ1bmN0aW9uIChvcHRpb25TZWxlY3RlZCkgewogICAgICAgICAgICB2YXIgcG9zaXRpb24gPSB0aGlzLm9wdGlvbnNTZWxlY3RlZC5pbmRleE9mKG9wdGlvblNlbGVjdGVkKTsKICAgICAgICAgICAgaWYgKHBvc2l0aW9uIDwgMCkgewogICAgICAgICAgICAgICAgdGhpcy5vcHRpb25zU2VsZWN0ZWQucHVzaChvcHRpb25TZWxlY3RlZCk7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnNTZWxlY3RlZC5zcGxpY2UocG9zaXRpb24sIDEpOwogICAgICAgICAgICB9CgogICAgICAgICAgICB2YXIgb3B0aW9uTnVtQnlJdGVtSWRzID0gbmV3IE1hcCgpOwogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMub3B0aW9uc1NlbGVjdGVkLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICAgICAgICB2YXIgb3B0aW9uID0gdGhpcy5vcHRpb25zU2VsZWN0ZWRbaV07CiAgICAgICAgICAgICAgICB2YXIgaXRlbUlkID0gb3B0aW9uLml0ZW0uaWQ7CiAgICAgICAgICAgICAgICBpZiAoIG9wdGlvbk51bUJ5SXRlbUlkcy5oYXMoaXRlbUlkKSkgewogICAgICAgICAgICAgICAgICAgIG9wdGlvbk51bUJ5SXRlbUlkcy5zZXQoaXRlbUlkLCBvcHRpb25OdW1CeUl0ZW1JZHMuZ2V0KGl0ZW1JZCkgKyAxKTsKICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgICAgb3B0aW9uTnVtQnlJdGVtSWRzLnNldChpdGVtSWQsIDEgKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKG9wdGlvbk51bUJ5SXRlbUlkcy5sZW5ndGggPCB0aGlzLmxvdHRlcnlSb3VuZC5sb3R0ZXJ5Lm1pbkl0ZW1OdW0pICB7CiAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlKCfor7fnu6fnu63pgInmi6knKTsKICAgICAgICAgICAgICAgIHRoaXMuZmVlID0gMDsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgbGV0IG1pblRvdGFsT3B0aW9uTnVtID0gMDsKICAgICAgICAgICAgZm9yIChsZXQgW2l0ZW1JZCwgaXRlbUJ5SXRlbV0gb2YgdGhpcy5pdGVtQnlJdGVtSWRzKSB7CiAgICAgICAgICAgICAgICBsZXQgbnVtID0gMDsKICAgICAgICAgICAgICAgIGlmIChvcHRpb25OdW1CeUl0ZW1JZHMuaGFzKGl0ZW1JZCkpIHsKICAgICAgICAgICAgICAgICAgICBudW0gPSBvcHRpb25OdW1CeUl0ZW1JZHMuZ2V0KGl0ZW1JZCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBpZiAobnVtIDwgaXRlbUJ5SXRlbS5taW5PcHRpb25OdW0pIHsKICAgICAgICAgICAgICAgICAgICB0aGlzLmZlZSA9IDA7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgbWluVG90YWxPcHRpb25OdW0gPSBtaW5Ub3RhbE9wdGlvbk51bSArIGl0ZW1CeUl0ZW0ubWluT3B0aW9uTnVtOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGxldCB0b3RhbEZlZSA9IHRoaXMubG90dGVyeVJvdW5kLmxvdHRlcnkuYmFzZUZlZTsKICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm9wdGlvbnNTZWxlY3RlZC5sZW5ndGggLSBtaW5Ub3RhbE9wdGlvbk51bTsgaSsrKSB7CiAgICAgICAgICAgICAgICB0b3RhbEZlZSA9IHRvdGFsRmVlICogdG90YWxGZWU7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgdGhpcy5mZWUgPSB0b3RhbEZlZTsKICAgICAgICB9LAogICAgICAgIHN1Ym1pdDogZnVuY3Rpb24oKSB7CiAgICAgICAgICAgIGxldCB0b3RhbEZlZSA9IHRoaXMuZmVlICogdGhpcy50aW1lczsKICAgICAgICAgICAgaWYgKHRvdGFsRmVlID4gdGhpcy5jdXN0b21lci5kZXBvc2l0KSB7CiAgICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlKCLkvZnpop3kuI3otrMiKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBsZXQgZGF0YSA9IHsKICAgICAgICAgICAgICAgICJjdXN0b21lciI6IHsiaWQiOiAiMSJ9LAogICAgICAgICAgICAgICAgImxvdHRlcnlSb3VuZCI6IHsiaWQiOiB0aGlzLmxvdHRlcnlSb3VuZC5pZH0sCiAgICAgICAgICAgICAgICAidGltZXMiOiB0aGlzLnRpbWVzLAogICAgICAgICAgICAgICAgIm9wdGlvbnMiOiB0aGlzLm9wdGlvbnNTZWxlY3RlZAogICAgICAgICAgICB9OwogICAgICAgICAgICBheGlvcwogICAgICAgICAgICAgICAgLnBvc3QoJ2h0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9hcGkvdjEvY3VzdG9tZXJzLzEvYmlkcycsIGRhdGEsIHtoZWFkZXJzOiB7J0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJ319KQogICAgICAgICAgICAgICAgLnRoZW4oKQogICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgeyAKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICB9LAogICAgbW91bnRlZCAoKSB7CiAgICAgICAgYXhpb3MKICAgICAgICAgICAgLmdldCgnaHR0cDovL2xvY2FsaG9zdDo4MDgwL2FwaS92MS9jdXN0b21lcnMvMScpCiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+ICh0aGlzLmN1c3RvbWVyID0gcmVzcG9uc2UuZGF0YSkpCiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsgCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgICAgIH0pOwogICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5nZXQoJ2h0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9hcGkvdjEvbG90dGVyaWVzLzEvcm91bmRzP3N0YXR1cz1hY3RpdmUnKQogICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLmRhdGEuY29udGVudC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG90dGVyeVJvdW5kID0gcmVzcG9uc2UuZGF0YS5jb250ZW50WzBdOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsgCiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7CiAgICAgICAgICAgIH0pOwogICAgICAgIGF4aW9zCiAgICAgICAgICAgIC5nZXQoJ2h0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9hcGkvdjEvbG90dGVyaWVzLzEvb3B0aW9ucycpCiAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgICAgICB2YXIgb3B0aW9ucyA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbnNCeWl0ZW0gPSBbXTsKICAgICAgICAgICAgICAgICAgICB2YXIgb3B0aW9uc0J5SXRlbUlkcyA9IG5ldyBNYXAoKTsKICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyBpICsrKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBvcHRpb24gPSBvcHRpb25zW2ldOwogICAgICAgICAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IG9wdGlvbi5pdGVtOwogICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9uc0J5SXRlbUlkcy5oYXMoaXRlbS5pZCkpIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNCeUl0ZW1JZHMuZ2V0KGl0ZW0uaWQpLnB1c2gob3B0aW9uKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNCeWl0ZW0gPSBbXTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnNCeWl0ZW0ucHVzaChvcHRpb24pOwogICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9uc0J5SXRlbUlkcy5zZXQoaXRlbS5pZCwgb3B0aW9uc0J5aXRlbSk7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pdGVtQnlJdGVtSWRzLnNldChpdGVtLmlkLCBpdGVtKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB0aGlzLm9wdGlvbnNCeUl0ZW1JZHMgPSBvcHRpb25zQnlJdGVtSWRzOwogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgeyAKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTsKICAgICAgICAgICAgfSk7CiAgICB9Cn0K"},{"version":3,"sources":["Lottery.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuDA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Lottery.vue","sourceRoot":"src/components","sourcesContent":["<template>\n    <div>\n        <div>\n            <div>账户余额：{{ customer.deposit }}</div>\n        </div>\n        <div>\n            <div style=\"line-height: 36px;\">\n                <div >\n                    彩票名称：{{ lotteryRound.lottery.name }}\n                </div>\n                <div>\n                    开奖日期：{{ lotteryRound.openingTime }}\n                </div>\n                <div style=\"overflow:hidden\" v-for=\"(optionsItemId, itemIndex) in optionsByItemIds.entries()\" v-bind:key=\"itemIndex\">\n                    <div></div>\n                    <div style=\"float:left;\">\n                        {{ itemByItemIds.get(optionsItemId[0]).name }}：\n                    </div>\n                    <div style=\"float:left;margin:2px;\" v-for=\"(option, optionIndex) of optionsItemId[1]\" v-bind:key=\"optionIndex\">\n                        <el-button v-on:click=\"selectOption(option)\" v-bind:class=\"optionsSelected.includes(option)?'select': 'unselect' \" size=\"small\" circle>\n                            <div style=\"width: 16px;\">\n                            {{ option.text }}\n                            </div>\n                        </el-button>\n                    </div>\n                </div>\n                <div style=\"overflow:hidden\">\n                    <div style=\"float:left;\">\n                            投注倍数：\n                    </div>\n                    <div  style=\"float:left;\">\n                        <el-input maxlength=\"5\" v-model=\"times\" placeholder=\"倍数\" size=\"small\" min=\"1\"></el-input>\n                    </div>\n                </div>\n                <div style=\"overflow:hidden\">\n                    <div style=\"float:left;\">\n                            单注费用：\n                    </div>\n                    <div style=\"float:left;\">\n                            {{ fee }}\n                    </div>\n                </div>\n                <div>\n                    <div>\n                        <el-button v-on:click=\"submit()\" size=\"small\" disabled=\"{{fee < 0}}\">\n                            确定\n                        </el-button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\nimport axios from 'axios'\n\nexport default {\n    data () {\n        return {\n            fee: 0,\n            current: null,\n            times: 1,\n            customer: { \"id\": \"\", \"deposit\": 0 },\n            lotteryRound: {\"lottery\": {\"name\":\"\"}},\n            optionsByItemIds: new Map(),\n            itemByItemIds: new Map(),\n            optionsSelected: []\n        }\n    },\n    methods: {\n        selectOption: function (optionSelected) {\n            var position = this.optionsSelected.indexOf(optionSelected);\n            if (position < 0) {\n                this.optionsSelected.push(optionSelected);\n            } else {\n                this.optionsSelected.splice(position, 1);\n            }\n\n            var optionNumByItemIds = new Map();\n            for (var i = 0; i < this.optionsSelected.length; i++) {\n                var option = this.optionsSelected[i];\n                var itemId = option.item.id;\n                if ( optionNumByItemIds.has(itemId)) {\n                    optionNumByItemIds.set(itemId, optionNumByItemIds.get(itemId) + 1);\n                } else {\n                    optionNumByItemIds.set(itemId, 1 );\n                }\n            }\n            \n            if (optionNumByItemIds.length < this.lotteryRound.lottery.minItemNum)  {\n                this.$message('请继续选择');\n                this.fee = 0;\n                return;\n            }\n\n            let minTotalOptionNum = 0;\n            for (let [itemId, itemByItem] of this.itemByItemIds) {\n                let num = 0;\n                if (optionNumByItemIds.has(itemId)) {\n                    num = optionNumByItemIds.get(itemId);\n                }\n                if (num < itemByItem.minOptionNum) {\n                    this.fee = 0;\n                    return;\n                }\n                minTotalOptionNum = minTotalOptionNum + itemByItem.minOptionNum;\n                \n            }\n            \n            let totalFee = this.lotteryRound.lottery.baseFee;\n            for (let i = 0; i < this.optionsSelected.length - minTotalOptionNum; i++) {\n                totalFee = totalFee * totalFee;\n            }\n            this.fee = totalFee;\n        },\n        submit: function() {\n            let totalFee = this.fee * this.times;\n            if (totalFee > this.customer.deposit) {\n                this.$message(\"余额不足\");\n                return;\n            }\n            let data = {\n                \"customer\": {\"id\": \"1\"},\n                \"lotteryRound\": {\"id\": this.lotteryRound.id},\n                \"times\": this.times,\n                \"options\": this.optionsSelected\n            };\n            axios\n                .post('http://localhost:8080/api/v1/customers/1/bids', data, {headers: {'Content-Type': 'application/json'}})\n                .then()\n                .catch(function (error) { \n                    console.log(error);\n                });\n        }\n    },\n    mounted () {\n        axios\n            .get('http://localhost:8080/api/v1/customers/1')\n            .then(response => (this.customer = response.data))\n            .catch(function (error) { \n                console.log(error);\n            });\n        axios\n            .get('http://localhost:8080/api/v1/lotteries/1/rounds?status=active')\n            .then(response => {\n                    if (response.data.content.length > 0) {\n                        this.lotteryRound = response.data.content[0];\n                    }\n                })\n            .catch(function (error) { \n                console.log(error);\n            });\n        axios\n            .get('http://localhost:8080/api/v1/lotteries/1/options')\n            .then(response => {\n                    var options = response.data;\n                    var optionsByitem = [];\n                    var optionsByItemIds = new Map();\n                    for (var i = 0; i < options.length; i ++) {\n                        var option = options[i];\n                        var item = option.item;\n                        if (optionsByItemIds.has(item.id)) {\n                            optionsByItemIds.get(item.id).push(option);\n                        } else {\n                            optionsByitem = [];\n                            optionsByitem.push(option);\n                            optionsByItemIds.set(item.id, optionsByitem);\n\n                            this.itemByItemIds.set(item.id, item);\n                        }\n                    }\n                    this.optionsByItemIds = optionsByItemIds;\n                })\n            .catch(function (error) { \n                console.log(error);\n            });\n    }\n}\n</script>\n\n<style>\n.select{\n    background-color: red;\n    color:white;\n}\n.select:hover{\n    background-color: red;\n    color:white;\n}\n.select:focus{\n    background-color: red;\n    color:white;\n}\n.unselect{\n    background-color: white;\n    border-color: #DCDFE6;\n}\n.unselect:hover{\n    background-color: white;\n    border-color: #DCDFE6;\n    color:black;\n}\n.unselect:focus{\n    background-color: white;\n    border-color: #DCDFE6;\n    color:black;\n}\n</style>"]}]}